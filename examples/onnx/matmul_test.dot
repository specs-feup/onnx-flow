digraph {
  graph [compound=true rankdir=LR];
  A [label=A shape=ellipse color=lime];
  B [label=B shape=ellipse color=lime];
  init_carry [label=init_carry shape=box];
  subgraph cluster_loop_Loop_0 {
    graph [compound=true rankdir=LR];
    loopLoop_0_iter [label=iter shape=ellipse color=lime];
    loopLoop_0_cond_in [label=cond_in shape=ellipse color=lime];
    loopLoop_0_carry [label=carry shape=ellipse color=lime];
    loopLoop_0_KN_0 [label=Mul shape=box color=blue];
    loopLoop_0_MN_0 [label=Mul shape=box color=blue];
    loopLoop_0_MKN_0 [label=Mul shape=box color=blue];
    loopLoop_0_shape2_A_0_d0_u [label=Unsqueeze shape=box color=blue];
    loopLoop_0_shape2_A_0_d1_u [label=Unsqueeze shape=box color=blue];
    loopLoop_0_concat_shape2_A_0 [label=Concat shape=box color=blue];
    loopLoop_0_reshape_reshape2D_A_0 [label=Reshape shape=box color=blue];
    loopLoop_0_shape2_B_0_d0_u [label=Unsqueeze shape=box color=blue];
    loopLoop_0_shape2_B_0_d1_u [label=Unsqueeze shape=box color=blue];
    loopLoop_0_concat_shape2_B_0 [label=Concat shape=box color=blue];
    loopLoop_0_reshape_reshape2D_B_0 [label=Reshape shape=box color=blue];
    loopLoop_0_Div_i_0 [label=Div shape=box color=blue];
    loopLoop_0_Mod_rem_0 [label=Mod shape=box color=blue];
    loopLoop_0_Div_j_0 [label=Div shape=box color=blue];
    loopLoop_0_Mod_k_0 [label=Mod shape=box color=blue];
    loopLoop_0_iU_0 [label=Unsqueeze shape=box color=blue];
    loopLoop_0_jU_0 [label=Unsqueeze shape=box color=blue];
    loopLoop_0_kU_0 [label=Unsqueeze shape=box color=blue];
    loopLoop_0_iMulN_0 [label=Mul shape=box color=blue];
    loopLoop_0_flat_no_batch_0 [label=Add shape=box color=blue];
    loopLoop_0_flatU_0 [label=Unsqueeze shape=box color=blue];
    loopLoop_0_flatU_0 -> loopLoop_0_scatter [label="{1}"];
    loopLoop_0_a_row_0 [label=Gather shape=box color=blue];
    loopLoop_0_reshape_a_vec_0 [label=Reshape shape=box color=blue];
    loopLoop_0_a_pick_0 [label=Gather shape=box color=blue];
    loopLoop_0_sq_a_sq_0 [label=Squeeze shape=box color=blue];
    loopLoop_0_b_col_0 [label=Gather shape=box color=blue];
    loopLoop_0_reshape_b_vec_0 [label=Reshape shape=box color=blue];
    loopLoop_0_b_pick_0 [label=Gather shape=box color=blue];
    loopLoop_0_sq_b_sq_0 [label=Squeeze shape=box color=blue];
    loopLoop_0_mul_0 [label=Mul shape=box color=blue];
    loopLoop_0_prev_0 [label=GatherElements shape=box color=blue];
    loopLoop_0_sq_prev_sq_0 [label=Squeeze shape=box color=blue];
    loopLoop_0_acc_0 [label=Add shape=box color=blue];
    loopLoop_0_updateUnsq [label=Unsqueeze shape=box color=blue];
    loopLoop_0_updateUnsq -> loopLoop_0_scatter [label="{1}"];
    loopLoop_0_id_cond [label=Identity shape=box color=blue];
    loopLoop_0_cond_out [label=cond_out shape=ellipse color=red];
    loopLoop_0_scatter [label=ScatterElements shape=box color=blue];
    loopLoop_0_carry_out [label=carry_out shape=ellipse color=red];
    loopLoop_0_id_cond -> loopLoop_0_cond_out [label=sc];
    loopLoop_0_cond_in -> loopLoop_0_id_cond [label=sc];
    loopLoop_0_carry -> loopLoop_0_scatter [label="{4}"];
    loopLoop_0_scatter -> loopLoop_0_carry_out [label="{4}"];
    A -> loopLoop_0_reshape_reshape2D_A_0 [style=dashed color=gray label="{2,2}"];
    B -> loopLoop_0_reshape_reshape2D_B_0 [style=dashed color=gray label="{2,2}"];
    graph [label="Loop Loop_0"];
    graph [style=dashed];
    graph [color=gray];
  }

  Y [label=Y shape=ellipse color=red];
  loopLoop_0_Loop_0 -> reshape_0 [label="{4}" ltail=cluster_loop_Loop_0];
  reshape_0 [label=Reshape shape=box color=blue];
  reshape_0 -> Y [label="{2,2}"];
}
